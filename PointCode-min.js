"use strict";var ua=detect.parse(navigator.userAgent),queryString=function(a){if(""==a)return{};for(var b={},c=0;c<a.length;++c){var d=a[c].split("=",2);1==d.length?b[d[0]]="":b[d[0]]=decodeURIComponent(d[1].replace(/\+/g," "))}return b}(window.location.search.substr(1).split("&")),AudioContext=window.AudioContext||window.webkitAudioContext,Point={wh:[1050,600],xy:[7,4],setLength:0,mainWaitDefault:2e3,mainWaitChange:80,maxNbr:14,masterGain:.05,fadeTimeFactor:1,initClear:!1,scoreModeList:["default","mellow","red","green","blue","redFull","greenFull","blueFull","grey","squares","lines","single","yellow"],metaWaitDefault:[60,60,40,40,40,40,40,40,40,60,60,40,20],scoreModeListExt:[],scoreModeChanged:!1,scoreShuffled:!1,scoreMode:queryString.mode,count:0,tuples:[],tuplesTemp:[],waitSign:-1,waitOrig:1,waitChanged:!1,mainTask:!1,metaTask:!1,switchValue:1,closeGUI:!1,fastForward:!1};Point.context=null;var usingWebAudio=!0;try{"undefined"!=typeof AudioContext?Point.context=new AudioContext:"undefined"!=typeof webkitAudioContext?Point.context=new webkitAudioContext:usingWebAudio=!1}catch(a){usingWebAudio=!1}if(usingWebAudio&&"suspended"===Point.context.state){var resume=function(){Point.context.resume(),setTimeout(function(){"running"===Point.context.state&&document.body.removeEventListener("touchend",resume,!1)},0)};document.body.addEventListener("touchend",resume,!1)}"Mobile Safari"==ua.browser.family?(Point.masterGain=.01,Point.maxNbr=3,Point.fadeTimeFactor=.5):"Mobile"==ua.device.type&&(Point.masterGain=.03,Point.maxNbr=3,Point.fadeTimeFactor=.8),window.innerHeight<window.innerWidth?(Point.orientation=0,Point.orientPrev=0,Point.margin=150,Point.width=Point.wh[0],Point.height=Point.wh[1],Point.nbrX=Point.xy[0],Point.nbrY=Point.xy[1],document.write('<canvas id="PointCanvas" width="'+Point.width+'" height="'+Point.height+'"></canvas>'),Point.canvas=document.getElementById("PointCanvas"),Point.canvas.style.width=window.innerWidth-Point.margin,Point.canvas.style.height=Point.canvas.style.width*Point.nbrY/Point.nbrX):(Point.orientation=1,Point.orientPrev=1,Point.margin=100,Point.width=Point.wh[1],Point.height=Point.wh[0],Point.nbrX=Point.xy[1],Point.nbrY=Point.xy[0],document.write('<canvas id="PointCanvas" width="'+Point.width+'" height="'+Point.height+'"></canvas>'),Point.canvas=document.getElementById("PointCanvas"),Point.canvas.style.height=window.innerHeight-Point.margin,Point.canvas.style.width=Point.canvas.style.height*Point.nbrX/Point.nbrY),window.addEventListener("resize",function(){window.innerHeight<window.innerWidth?(Point.orientation=0,Point.canvas.style.width=window.innerWidth-Point.margin):(Point.orientation=1,Point.canvas.style.height=window.innerHeight-Point.margin),Point.orientation!=Point.orientPrev&&setTimeout(function(){window.location.reload()})},!1),window.addEventListener("orientationchange",function(){window.location.reload()},!1),Point.boxes=Point.canvas.getContext("2d"),Point.nbrXpix=Math.floor(Point.width/Point.nbrX),Point.nbrYpix=Math.floor(Point.height/Point.nbrY),Point.boxPix=Math.min(Point.nbrXpix,Point.nbrYpix),Point.scoreMode||(Point.scoreMode=Point.scoreModeList[randInt(0,Point.scoreModeList.length)]),Point.scoreModeCurrent=Point.scoreMode;for(var i=0;i<Point.scoreModeList.length;i++)Point.scoreModeListExt.push({name:Point.scoreModeList[i],nbrBoxes:[],colors:[]});for(var x=0;x<Point.nbrX;x++)for(var y=0;y<Point.nbrY;y++)Point.tuples.push([x,y]);Point.switch=function(){var a=document.getElementsByClassName("button");if(Point.switchValue=(Point.switchValue+1)%2,1==Point.switchValue){for(var b=0;b<a.length;b++)a[b].style.visibility="hidden";document.getElementById("close").value=">"}else{for(var b=0;b<a.length;b++)a[b].style.visibility="visible";document.getElementById("close").value="<"}},Point.close=function(){clearTimeout(Point.closeGUI),0==Point.switchValue&&(Point.closeGUI=setTimeout(Point.switch,1e4))},Point.start=function(a){if("init"==a&&"Mobile Safari"==ua.browser.family){var b,d=document.getElementsByClassName("button");b="iPad"==ua.device.family?"60px":"40px";for(var e=0;e<d.length;e++)d[e].style.width=b;Point.switch()}else Point.mainTask.running||(Point.clearTo([0,0,0]),Point.init(),Point.flicker())},Point.stop=function(){Point.mainTask.stop(),Point.metaTask.stop(),Point.clearTo([0,0,0]),Point.flicker("stop")},Point.flicker=function(a){var b=100,c=[0,0];switch(a||(a="start"),a){case"stop":b=200,c=[Point.nbrX-1,Point.nbrY-1];break;default:b=100}Point.clearTo([255,255,255],c),setTimeout(Point.clearTo,1*b,[0,0,0],c),setTimeout(Point.clearTo,2*b,[255,255,255],c),setTimeout(Point.clearTo,3*b,[0,0,0],c),setTimeout(Point.clearTo,4*b,[255,255,255],c),setTimeout(Point.clearTo,5*b,[0,0,0],c),setTimeout(Point.clearTo,6*b,[255,255,255],c),setTimeout(Point.clearTo,7*b,[0,0,0],c),setTimeout(Point.clearTo,8*b,[255,255,255],c),setTimeout(Point.clearTo,9*b,[0,0,0],c),"stop"==a&&setTimeout(function(){Point.boxes.font="20px monaco",Point.boxes.fillStyle="rgb(255,255,255)",Point.boxes.fillText(">goodbye",Point.boxPix*c[0],Point.boxPix*c[1]+20),setTimeout(Point.clearTo,40*b,[0,0,0],c)},10*b)},Point.taskConstructor=function(a,b){var c={wait:b,func:a,running:!0,timeout:!1,start:function(){return this.running=!0,this.loop()},loop:function(){return this.timeout=setTimeout(this.runLoop,this.wait),this},runLoop:function(){var a;if(c.running){if(a=c.func.call(c),"number"==typeof a){if(0===a)return;c.wait=a}c.loop()}},stop:function(){this.running=!1,clearTimeout(this.timeout)}};return c.start()},Point.init=function(){Point.initClear&&Point.clearTo(),Point.tuplesTemp=Point.tuples,shuffleArray(Point.tuplesTemp),Point.selectScoreMode("init"),Point.mainTask=Point.taskConstructor(function(){var a=this.wait;return Point.count+=1,Math.random()<.5&&(Point.scoreModeChanged||Math.random()<.05)&&Point.clearTo([0,0,0]),Point.count%80==79&&Point.shuffleScore(),Point.drawBoxes(a/1e3/2),Point.waitChanged&&(a=Point.waitOrig,Point.waitChanged=!1),Point.scoreModeChanged&&(Point.scoreModeChanged=!1),Point.scoreShuffled&&(Point.scoreShuffled=!1),a<.5*Point.mainWaitDefault&&(Point.waitSign=1),a>2*Point.mainWaitDefault&&(Point.waitSign=-1),a+=Point.waitSign*Point.mainWaitChange*Math.random(),(Math.random()<.1||Point.fastForward)&&(Point.waitOrig=a,a>Point.mainWaitDefault?a/=2:a*=2,Point.waitChanged=!0),a},Point.mainWaitDefault),Point.metaTask=Point.taskConstructor(function(){var a;return Point.fastForward=!1,Point.selectScoreMode(),a=Point.metaWaitDefault[Point.scoreModeList.indexOf(Point.scoreMode)],a+=-5+10*Math.random(),Math.random()<.2&&(a=5+10*Math.random(),Point.fastForward=!0),1e3*a},1e3*Point.metaWaitDefault[Point.scoreModeList.indexOf(Point.scoreMode)]),Point.metaTask.stop(),Point.mainTask.stop(),setTimeout(function(){Point.mainTask.start(),Point.metaTask.start()},0),Point.setLength>0&&setTimeout(function(){Point.mainTask.stop()},1e3*Point.setLength)},Point.selectScoreMode=function(a){if("init"!=a)for(;Point.scoreMode==Point.scoreModeCurrent;)Point.scoreMode=Point.scoreModeList[randInt(0,Point.scoreModeList.length-1)];Point.scoreModeChanged=!0,Point.shuffleScore(),Point.scoreModeCurrent=Point.scoreMode},Point.shuffleScore=function(){var a=Point.scoreModeList.indexOf(Point.scoreMode);switch(Point.scoreShuffled=!0,Point.scoreModeListExt[a].nbrBoxes=fillArray(4,7,1,1).concat(fillArray(7,12,3,6).concat(fillArray(1,2,1,1).concat(fillArray(2,4,Point.nbrX*Point.nbrY/2,Point.nbrX*Point.nbrY).concat(fillArray(6,10,1,3))))),Point.nbrBoxes=Point.scoreModeListExt[a].nbrBoxes,Point.scoreMode){case"red":Point.scoreModeListExt[a].colors=[[[100,0,0],[255,0,0]]];break;case"green":Point.scoreModeListExt[a].colors=[[[0,100,0],[0,255,0]]];break;case"blue":Point.scoreModeListExt[a].colors=[[[0,0,100],[0,0,255]]];break;case"redFull":Point.scoreModeListExt[a].colors=[[[0,0,0],[255,0,0]]];break;case"greenFull":Point.scoreModeListExt[a].colors=[[[0,0,0],[0,255,0]]];break;case"blueFull":Point.scoreModeListExt[a].colors=[[[0,0,0],[0,0,255]]];break;case"yellow":Point.scoreModeListExt[a].colors=[[[255,255,0],[255,255,230]]];break;case"grey":for(var b=0;b<randInt(5,10);b++)Point.scoreModeListExt[a].colors.push([Array(3).fill(randInt(0,255)),[255,255,255]]),Point.scoreModeListExt[a].colors[b][1]=Point.scoreModeListExt[a].colors[b][0];break;case"mellow":for(var b=0;b<randInt(25,35);b++){Point.scoreModeListExt[a].colors.push([fillArray(3,3,85,153),[255,255,255]]);for(var c=0;c<3;c++)Point.scoreModeListExt[a].colors[b][1][c]=Point.scoreModeListExt[a].colors[b][0][c]+25}break;case"squares":for(var b=0;b<randInt(25,35);b++){Point.scoreModeListExt[a].colors.push([fillArray(3,3,85,153),[255,255,255]]);for(var c=0;c<3;c++)Point.scoreModeListExt[a].colors[b][1][c]=Point.scoreModeListExt[a].colors[b][0][c]+25}break;case"lines":for(var d=0,b=0;b<randInt(1,4);b++)Math.random()<.5?Point.scoreModeListExt[a].colors.push([[255,255,255],[255,255,255]]):Point.scoreModeListExt[a].colors.push([[0,0,0],[0,0,0]]),d+=1;for(var b=0;b<randInt(3,6);b++){Point.scoreModeListExt[a].colors.push([[255*randInt(0,1),255*randInt(0,1),255*randInt(0,1)],[0,0,0]]);for(var c=0;c<3;c++)255==Point.scoreModeListExt[a].colors[d][0][c]&&(Point.scoreModeListExt[a].colors[d][1][c]=randInt(200,255));d+=1}break;default:for(var d=0,b=0;b<randInt(15,25);b++)Point.scoreModeListExt[a].colors.push([[0,0,0],[255,255,255]]),d+=1;for(var b=0;b<randInt(5,15);b++){Point.scoreModeListExt[a].colors.push([fillArray(3,3,85,153),[255,255,255]]);for(var c=0;c<3;c++)Point.scoreModeListExt[a].colors[d][1][c]=Point.scoreModeListExt[a].colors[d][0][c]+randInt(10,25);d+=1}for(var b=0;b<randInt(5,8);b++){Point.scoreModeListExt[a].colors.push([fillArray(3,3,200,230),[255,255,255]]);for(var c=0;c<3;c++)Point.scoreModeListExt[a].colors[d][1][c]=Point.scoreModeListExt[a].colors[d][0][c]+randInt(10,25);d+=1}for(var b=0;b<randInt(5,8);b++){Point.scoreModeListExt[a].colors.push([fillArray(3,3,10,30),[255,255,255]]);for(var c=0;c<3;c++)Point.scoreModeListExt[a].colors[d][1][c]=Point.scoreModeListExt[a].colors[d][0][c]+randInt(10,25);d+=1}}Point.colors=Point.scoreModeListExt[a].colors},Point.clearTo=function(a,b){var c=0;a||(c=1),b?(Point.boxes.fillStyle="rgb("+a[0]+","+a[1]+","+a[2]+")",Point.boxes.fillRect(Point.boxPix*b[0],Point.boxPix*b[1],Point.boxPix,Point.boxPix)):Point.tuples.forEach(function(b,d){1==c&&(a=fillArray(3,3,0,255)),Point.boxes.fillStyle="rgb("+a[0]+","+a[1]+","+a[2]+")",Point.boxes.fillRect(Point.boxPix*b[0],Point.boxPix*b[1],Point.boxPix,Point.boxPix)})},Point.drawBoxes=function(a){var h,b=new Array(3),c=new Array(3),g=[],i=Point.nbrBoxes[Point.count%Point.nbrBoxes.length];switch("single"!=Point.scoreMode&&(Point.tuplesTemp=Point.tuples,shuffleArray(Point.tuplesTemp)),Point.scoreMode){case"single":i=1,Point.scoreModeChanged||Point.scoreShuffled?(Point.tuplesTemp=Point.tuples,shuffleArray(Point.tuplesTemp),Point.tuplesTemp=Point.tuplesTemp.filter(function(a,b){if(b<randInt(2,4))return a})):(h=Point.tuplesTemp.shift(),Point.tuplesTemp.push(h));break;case"squares":var j=randInt(0,Point.nbrX-2),k=randInt(0,Point.nbrY-2);i=4,Point.tuplesTemp=Point.tuplesTemp.filter(function(a){return a.equals([j,k])||a.equals([j+1,k])||a.equals([j,k+1])||a.equals([j+1,k+1])}),Math.random()<.1&&Point.clearTo([0,0,0]);break;case"lines":var j,k;Math.random()<.5?(j=randInt(0,Point.nbrX-1),i=Point.nbrY,Point.tuplesTemp=Point.tuplesTemp.filter(function(a){return a[0]==j})):(k=randInt(0,Point.nbrY-1),i=Point.nbrX,Point.tuplesTemp=Point.tuplesTemp.filter(function(a){return a[1]==k}))}for(var l=0;l<i;l+=1){g=Point.tuplesTemp[l];for(var m=0;m<3;m++)b[m]=randInt(Point.colors[Point.count%Point.colors.length][0][m],Point.colors[Point.count%Point.colors.length][1][m]),c[m]=randInt(Point.colors[Point.count%Point.colors.length][0][m]+100,Point.colors[Point.count%Point.colors.length][1][m]+100);l<Point.maxNbr&&Point.play(b,a,g[0],g[1]),Point.boxes.fillStyle="rgb("+b[0]+","+b[1]+","+b[2]+")",Point.boxes.fillRect(Point.boxPix*g[0],Point.boxPix*g[1],Point.boxPix,Point.boxPix),Point.scoreModeChanged&&0==l&&Math.random()<.3&&(Point.boxes.font="20px monaco",Point.boxes.fillStyle="rgb("+c[0]+","+c[1]+","+c[2]+")",Point.boxes.fillText("> "+Point.scoreMode,Point.boxPix*g[0],Point.boxPix*g[1]+20))}},Point.play=function(a,b,c,d){var t,e=[80,200,400],f=0,g=[0,0,0],h=.1,i=Math.min(2,2*b)*Point.fadeTimeFactor,j="sine",k=Point.context.createOscillator(),l=Point.context.createOscillator(),m=Point.context.createOscillator(),n=Point.context.createGain(),o=Point.context.createGain(),p=Point.context.createGain(),q=Point.context.createGain(),r=Point.context.createGain(),s=Point.context.createDynamicsCompressor();if("Safari"!=ua.browser.family&&"Mobile Safari"!=ua.browser.family)var u=Point.context.createStereoPanner();e=[50+a[0]/255*100,200+a[1]/255*200,400+a[2]/255*400];for(var v=0;v<e.length;v++)e[v]=e[v]*(Point.nbrY-d);e=[f+Number(e[0].toFixed()),f+Number(e[1].toFixed()),f+Number(e[2].toFixed())],g=[a[0]/255,a[1]/255,a[2]/255].map(Math.sqrt),g.equals([0,0,0])&&(g=[.3,.3,.3]),k.type=j,k.frequency.value=e[0],n.gain.value=g[0],l.type=j,l.frequency.value=e[1],o.gain.value=g[1],m.type=j,m.frequency.value=e[2],p.gain.value=g[2],s.threshold.value=-12,s.knee.value=40,s.ratio.value=12,s.attack.value=.001,s.release.value=.25,k.connect(n),l.connect(o),m.connect(p),n.connect(q),o.connect(q),p.connect(q),q.connect(r),"Safari"!=ua.browser.family&&"Mobile Safari"!=ua.browser.family?(u.pan.value=c/((Point.nbrX-1)/2)-1,r.connect(u),u.connect(s)):r.connect(s),s.connect(Point.context.destination),r.gain.setValueAtTime(0,Point.context.currentTime),r.gain.linearRampToValueAtTime(Point.masterGain,Point.context.currentTime+h),k.start(0),l.start(0),m.start(0),q.gain.setValueCurveAtTime(Point.lfoValues(b+i),Point.context.currentTime,b+i),setTimeout(function(){r.gain.setValueAtTime(Point.masterGain,Point.context.currentTime),r.gain.linearRampToValueAtTime(0,Point.context.currentTime+i),k.stop(Point.context.currentTime+i),l.stop(Point.context.currentTime+i),m.stop(Point.context.currentTime+i),setTimeout(function(){clearInterval(t)},1e3*i)},1e3*b)},Point.lfoValues=function(a){for(var d,b=4096,c=new Float32Array(b),e=.5+10*Math.random(),f=.1+.3*Math.random(),g=0;g<b;g++)d=g/b*a*e,c[g]=1-f+Math.sin(2*d*Math.PI)*f;return c};